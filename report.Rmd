---
title: "SaniPath Exposure Assessment Report"
author: "Yuke Wang"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output:
  html_document: null
  pdf_document: default
  toc: yes
---

This is a test version of **SaniPath** tool report. This report can be download as 'HTML', 'PDF', and 'MS word' documents.
For any infomration and questions, please contact [Yuke Wang](yuke.wang@emory.edu).

Pie charts:

```{r, fig.width=14, fig.height=3, echo=FALSE}
  be_data<-be_data()
  freq<-frq()
  n.neighb=ifelse(input$neighb==0, length(unique(as.numeric(be_data$neighbor))),1)
  n.path=1
  n.age=ifelse(input$ad_ch==0, 2, 1)
  if (n.neighb==1 & input$neighb!=0) {k.neighb=as.numeric(input$neighb)} else {k.neighb=sort(unique(as.numeric(be_data$neighbor)))}
  if (input$samtype!=0) {k.path=as.numeric(input$samtype)} else {k.path=1}
  if (n.age==1 & input$ad_ch!=0) {k.age=as.numeric(input$ad_ch)} else {k.age=c(1,2)}
  nrow=n.path
  ncol=n.age*n.neighb
  par(mfrow=c(nrow,ncol))
  par(mar=c(0.5,6.5,4.5,6.5))
  label1<-c(">10 times/month","6-10 times/month","1-5 times/month","never","don't know")
  label_path<-c("Drain Water", "Produce", "Piped Water", "Ocean Water", "Surface Water", "Flood Water", "Public Latrine Surfaces", "Particulate", "Bathing")
  label_age<-c("Adults","Children")
  if (input$samtype!=8 & input$samtype!=9){
  for (i in 1:n.path){
    for (j in 1:n.neighb){
      for (k in 1:n.age){
        slices <- c(table(as.numeric(freq[[14*(k.neighb[j]-1)+2*(k.path-1)+k.age[k]]]))) 
        label1<-c(">10 times/month","6-10 times/month","1-5 times/month","never","don't know")
        pct <- c(0,0,0,0,0)
        pct[sort(unique(as.numeric(freq[[14*(k.neighb[j]-1)+2*(k.path-1)+k.age[k]]])))] <- round(slices/sum(slices)*100)
        label1 <- paste(label1, "\n", pct, sep="") # add percents to labels 
        label1 <- paste(label1,"%",sep="") # add % to labels 
        pie(slices,
            labels = label1[sort(unique(as.numeric(freq[[14*(k.neighb[j]-1)+2*(k.path-1)+k.age[k]]])))], 
            col=rainbow(5)[sort(unique(as.numeric(freq[[14*(k.neighb[j]-1)+2*(k.path-1)+k.age[k]]])))],
            main=paste("Neighborhood ",k.neighb[j],", ",label_path[k.path],", ",label_age[k.age[k]]),
            cex=1.3,cex.main=1.5,init.angle = 90)
      }
    }
  }
  }
```