---
title: "SaniPath Exposure Assessment Report"
author: "Yuke Wang"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output:
  html_document: null
  pdf_document: default
  toc: yes
---
```{r,echo=FALSE}
library(knitr)
```

**Methods**

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam elit ex, dignissim nec mattis ut, pellentesque at tortor. Aenean tincidunt auctor elementum. Curabitur lectus sapien, finibus quis erat at, pretium egestas risus. Etiam odio neque, dignissim non ante a, tincidunt gravida magna. Phasellus lorem dui, vehicula non facilisis vel, hendrerit at mi. Phasellus congue lectus augue, eget aliquet nibh vestibulum nec. Praesent efficitur ut ipsum vel pretium. Praesent nibh nulla, congue sed accumsan quis, molestie non nibh.

Nunc augue dui, ultrices in volutpat in, sollicitudin et dui. Maecenas tincidunt quam eget eros commodo, quis vehicula risus ornare. Mauris elit magna, varius sed ex sed, faucibus volutpat lacus. In sit amet tempus enim. In ut lacinia nunc. Sed metus libero, convallis at scelerisque vel, posuere sed libero. Aliquam eu ligula eget quam porta convallis quis at felis. Morbi auctor consectetur lorem, a interdum elit bibendum ut. Lorem ipsum dolor sit amet, consectetur adipiscing elit.

**Map of Survey Area**

```{r, echo=FALSE}
cat('----------------------------------------------------------------\n
- Map of neighborhoods\n
-\n
-\n
-\n
-\n
-\n
-\n
-\n
-\n
-\n
-\n
----------------------------------------------------------------')


```

**Tables of Collected Results**

```{r, echo=FALSE}
# path_results <- matrix(sample(200,2*9),nrow=2, ncol=9)
# rownames(path_results) <- c("Neighborhood 1", "Neighborhood 2")
# colnames(path_results) <- paste("Sample",1:9)
# kable(path_results)

survey_results <- cbind(as.vector(table(community_data()$neighbor)), # community data
                        as.vector(table(school_data()$neighbor)), # school data
                        as.vector(table(household_data()$neighbor))
)


colnames(survey_results) <- c("Community", "School", "Household")
rownames(survey_results) <- paste('Neighborhood',1:nrow(survey_results))
kable(survey_results)

participant_results <- matrix(sample(200,2*3),nrow=2, ncol=3)
colnames(participant_results) <- c("Community", "School", "Household")
rownames(participant_results) <- c("Neighborhood 1", "Neighborhood 2")
kable(participant_results)
```



Pie charts:

#```{r, fig.width=14, fig.height=3, echo=FALSE}
  be_data<-be_data()
  freq<-frq()
  n.neighb=ifelse(input$neighb==0, length(unique(as.numeric(be_data$neighbor))),1)
  n.path=1
  n.age=ifelse(input$ad_ch==0, 2, 1)
  if (n.neighb==1 & input$neighb!=0) {k.neighb=as.numeric(input$neighb)} else {k.neighb=sort(unique(as.numeric(be_data$neighbor)))}
  if (input$samtype!=0) {k.path=as.numeric(input$samtype)} else {k.path=1}
  if (n.age==1 & input$ad_ch!=0) {k.age=as.numeric(input$ad_ch)} else {k.age=c(1,2)}
  nrow=n.path
  ncol=n.age*n.neighb
  par(mfrow=c(nrow,ncol))
  par(mar=c(0.5,6.5,4.5,6.5))
  label1<-c(">10 times/month","6-10 times/month","1-5 times/month","never","don't know")
  label_path<-c("Drain Water", "Produce", "Piped Water", "Ocean Water", "Surface Water", "Flood Water", "Public Latrine Surfaces", "Particulate", "Bathing")
  label_age<-c("Adults","Children")
  if (input$samtype!=8 & input$samtype!=9){
  for (i in 1:n.path){
    for (j in 1:n.neighb){
      for (k in 1:n.age){
        slices <- c(table(as.numeric(freq[[14*(k.neighb[j]-1)+2*(k.path-1)+k.age[k]]]))) 
        label1<-c(">10 times/month","6-10 times/month","1-5 times/month","never","don't know")
        pct <- c(0,0,0,0,0)
        pct[sort(unique(as.numeric(freq[[14*(k.neighb[j]-1)+2*(k.path-1)+k.age[k]]])))] <- round(slices/sum(slices)*100)
        label1 <- paste(label1, "\n", pct, sep="") # add percents to labels 
        label1 <- paste(label1,"%",sep="") # add % to labels 
        pie(slices,
            labels = label1[sort(unique(as.numeric(freq[[14*(k.neighb[j]-1)+2*(k.path-1)+k.age[k]]])))], 
            col=rainbow(5)[sort(unique(as.numeric(freq[[14*(k.neighb[j]-1)+2*(k.path-1)+k.age[k]]])))],
            main=paste("Neighborhood ",k.neighb[j],", ",label_path[k.path],", ",label_age[k.age[k]]),
            cex=1.3,cex.main=1.5,init.angle = 90)
      }
    }
  }
  }
```